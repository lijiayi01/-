# 生产级别项目的表设计

## 1. 表设计规范

### 1. 命名规范

- 数据库对象名全部使用小写字母加_格式，比如user_name
- 数据库对象名禁止使用mysql保留字
- 最好不要超过32个字符
- 临时表必须tmp为前缀并以日期为后缀
- 备份表必须以bak为前缀并以日期为后缀
- 所有存储相同数据的列名和列类型必须相同

### 2. 数据库设计规范

- 所有表必须使用Innodb存储引擎(5.6以后默认的引擎)
- 数据库和表的字符集统一使用utf8(要统一字符集)
- 所有的表和字段都需要添加注释(comment从句来添加)
- 尽量控制单表数据量的大小，建议控制在500w以内(历史数据分档 分库分表)
- 谨慎使用mysql分区表
- 尽量做到冷热数据分离，减少表的宽度（也就是列的数量），mysql最多能存4096列
- 禁止在表中建立预留字段(***)
- 禁止在数据库中存储图片 文件等二进制数据
- 禁止在线上做数据库压力测试
- 禁止从开发 测试环境直接连接生产环境数据库

### 3. 索引设计规范

- 限制每张表的索引数量，建议单张表索引数量不超过5个
- 每张表必须有一个主键
    - 不使用更新频繁的列作为索引，不使用多列主键
    - 使用uuid md5 hash 字符串列作为主键
    - 建议使用自增id 
- 常见索引列建议
    - select update delete语句的where从句中的列
    - 包含在order by 、 group by、 distinct 中的字段
    - 多表join的关联列
- 如何选择索引列顺序
    - 从左到右顺序来使用的
    - 区分度最高的列放在联合索引的最左侧
    - 尽量把字段长度小的列放在联合索引的最左侧
    - 使用频繁的列放在联合索引最左侧
- 避免建立冗余索引和重复索引
    - primary(id) index(id) unique index(id) --- 重复了，不要这样使用
    - index(a,b,c) index(a,b) index(a) -- 冗余了
- 对于频繁的查询优先考虑使用覆盖索引
- 尽量避免使用外检

### 4. 数据库字段设计规范

- 优先选择符合存储需要的最小的数据类型
    - 将字符串转换为数字类型存储
        - inet_aton('255.255.255.255') = 4294967295 ip转为数字
        - inet_aton(4294967295) = '255.255.255.255' 数字转ip
    - 对于非负数据采用无符号整型存储
    - varchar(n) n代表字符数，不是字节数（使用utf8存储汉字varchar(255)需要765个字节）
    - 过长的长度会消耗更多内存
- 避免使用TEXT BLOB数据类型
- 避免使用ENUM数据类型
- 尽可能把所有列定义为not null
- 使用timestamp或者datetime类型存储时间
- 同财务相关的金额类数据，必须使用decimal类型

### 5. 数据库SQL开发规范

- 建议使用预编译语句进行数据库操作
- 避免数据类型的隐式转化
- 避免使用双%查询条件
- 禁止使用select *
- 禁止使用不含字段列表的insert语句
- 避免子查询，可以把子查询优化为join操作
- 避免使用join关联太多的表










 



