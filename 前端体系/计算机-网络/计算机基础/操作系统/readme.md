# 操作系统入门

本文都是理论知识，不会过深的讲解操作系统是如何运行的。只会简单的讲一些基础知识作为入门。

## 操作系统的认识

提起操作系统，我们第一印象可能就是windows linux等我们常用的操作系统。它的作用主要是运行某个程序 增删改查文件(夹) 等等。

说起计算机，它其实由硬件(cpu 内存 磁盘 鼠标 键盘 显示器) 软件(用户下载的程序，比如微信 qq qq音乐等等) 操作系统组成。

操作系统在中间的作用主要是管理软件，为这些软件分配硬件资源，提高用户使用计算机的方便性。

见![下图](./img/操作系统的地位.png)

计算机最终是提供给用户使用的。用户可能无法理解cpu 内存，各种调度方案，所以操作系统要做的就是尽可能的简化用户的操作，将那些复杂的调度方案彻底隐藏起来。用户都是通过操作系统来使用计算机的。

## 操作系统的功能：

上面我们只是简单的提到了操作的系统的功能，下面我们从更加专业的方式来说明操作系统对cpu如何调度 内存如何调度等等知识。


计算机的系统资源分为硬件资源和软件资源，硬件资源就是上面我们提到的cpu 内存 磁盘等，软件资源是存放在计算机系统中的文件 数据  程序等等。

操作系统的硬件管理分为cpu管理 存储管理 设备管理 文件管理

### cpu管理

cpu管理的主要作用是 合理有效的使用cpu资源，提高计算机使用效率。

cpu管理主要涉及进程和cpu算法调度开始讲解：

#### 进程

进程是一个程序在一个数据集上的一次执行过程，是动态的。

比如：我们打开word文档，就是开启了一个进程。打开qq，也是开启了一个进程。<br>
再比如打开chrome浏览器去打开n个tab页，这些都属于开启了一个进程。

windows可以在任务管理器中查看。

但是需要注意的是：chrome中打开n个tab页，其实就是开启了n个进程。我们打开了n个word文档，也属于开启了n个进程。

所以，不要认为： 一个程序就代表了一个进程。因为进程是动态的，一个程序可能对应多个进程。如果关闭了程序，这个进程也就关闭了。

我们学习编程语言，总会遇到"多线程"的概念。

一个进程包含了多个线程。进程 > 线程

一定不要误解了进程和线程。

那进程是如何开启的呢?

操作系统创建进程时，必须要为该进程准备cpu资源 内存资源。如果资源不足，进程无法创建。在程序执行过程中，进程的资源状态随之变化。当执行完毕以后，进程关闭，资源回收。

所以，进程是系统分配资源的单位。

计算机运行过程中总会有很多进程存在，通过操作系统的控制，对进程进行切换，从而实现多道程序控制的目的。

那当进程切换时，肯定需要保存当前进程的状态(比如内存，cpu资源)。因此，操作系统对于每一个进程都会设置一个"进程控制块"(Process Control Block, PCB)，通过这个"进程控制块"来保存进程的相关信息，包括资源信息 管理信息 运行状态。

进程控制块随着进程创建而创建，随着进程销毁而销毁。进程控制块一般包含以下几类信息:

1. 进程标识

    就是进程id，每一个进程会有唯一的进程id。
    Node中可通过```process.pid```获取Node当前进程id

2. 运行信息

    运行信息是与进程执行的信息，主要包含进程程序存放地址 进程数据存放地址 进程运行过程中获得的结果存放在哪些cpu的寄存器，当进程重新执行时，就可从上次的结果继续执行。

3. 状态信息

    状态信息用于说明进程执行的情况，进程一般分为运行状态 就绪状态 等待状态，这3种状态作为进程调度时分配处理器资源的主要依据。

4. 管理信息

    管理信息用于进程的调度和通信。比如优先级 所用的信号量 队列指针等。

#### cpu调度算法

上面提到了进程的创建需要cpu资源，那cpu是如何分配资源的呢?

下面说几种常用的cpu调度方法:

1. 先来先服务法

    就是排对法，根据进程进入就绪状态的先后顺序来分配cpu资源。

2. 优先级调度算法

    为每一个进程确定一个优先级，就绪状态的进程队列按照优先级的方式来分配资源

3. 时间片轮询法

    将cpu资源按照单位时间划分出"时间片"，时间片的长度一般是固定的,如50ms，为每一个进程按照"时间片"分配cpu资源。其实这也是操作系统通常使用的方式，比如计算机同时运行多个软件(微信 qq qq音乐),比如操作系统为微信分配50ms的cpu资源，50ms过后，微信进程进程就绪状态，cpu资源分配给qq，依次类推。通过这种方式，让用户以为软件在同时运行，其实从微观来讲，它们并非是同时运行，只是这个时间片时间足够短，用户无从感知。

### 存储管理

计算机中的存储器分为两类: 主存储器(内存/主存) 辅助存储器(外存)

经常我们查看电脑的配置，一般都说8G+500G，其实这个8G就是我们这里提到的内存，500G属于硬盘内存，硬盘是可以拆卸的。

内存的存储空间分为两类: 系统区(存放操作系统相关数据) 用户区(存放用户数据)

下面我们通过js来解释内存的分配问题

```
var a = 1;
var b = 2
```

上面两行代码是创建了两个变量a,b

在代码编译过程中，需要创建为a和b分配内存空间，但是此时编译器还不知道程序具体分配到内存中的哪个地址，所以在编译过程中，都是从地址0开始分配策划程序代码和数据，这个地址成为逻辑地址。

在我们计算机的内存中，其实是由一系列的内存单元组成，每个内存单元有唯一的编号，这个编号成为物理地址。

在程序装入内存的时候，将逻辑地址转换为物理地址，本质是为程序和地址重新分配存储地址，也成为地址重定位。

存储管理的作用是: 

1. 内存的分配和回收

    cpu能直接访问的存储空间是内存，任何的程序和数据只有放到内存中才可以被cpu执行。<br>

    在高级语言中，程序员一般无需关注内存的分配和回收。

    内存分配的一般策略有一下几种：

    - 直接分配: 开发者直接将物理地址写在源代码中，对于开发者要求比较高

    - 静态分配: 程序在装入内存中时，将所有的所需的内存的物理地址进行申请，在存储空间确定后，在程序运行过程中都不会改变。此方法效率比较低

    - 动态分配：程序在装入内存中时，不是将所有的所需的内存的物理地址进行申请，只申请需要的部分。存储空间是动态申请 动态确定 动态调整的，现在操作系统都用这种方法

2. 地址重定位：

    就是将逻辑内存转化为物理内存。

    一般方法有两种:

    静态重定位: 程序装入内存时，将所有的逻辑内存转化为物理内存，这种方式要求使用连续的内存,存放地址在执行过程中不可改变。

    动态重定位: 在程序过程中，根据内存使用情况，动态转化，对于不使用的程序数据先不进行转化。

3. 内存共享和保护

    内存共享: 多个进程可访问同一段内存信息,可以实现进程之间通信

    内存保护： 每个进程只能访问它自己的内存空间和共享的内存空间,不允许访问其他的进程内存。


### 设备管理

计算机中，除了cpu和内存，其他大部分硬件都属于外设。

比如打印机 鼠标 键盘等。

在编程过程中，我们也需要考虑它。

所以就不对它进行详细说明

设备管理的作用： 1.提高设备利用率 2.方便用户使用

### 文件管理

可以想象我们使用文件的过程。

操作系统提供给我们创建文件  删除文件 修改文件等功能。

在编程中，编程语言也提供了相关的api。

这里我们也不会深入讲解。

## 总结：

其实也可以通过篇幅知道本文的重点，就是cpu管理和内存管理。

可能本文对于编程没有多大必要，但是对于我们认识程序如何运行是非常重要的。